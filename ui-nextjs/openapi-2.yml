openapi: 3.0.3
info:
  title: Singapore Haze Prediction API
  description: |
    Real-time haze forecasting system for Singapore government dashboard.

    Predicts PSI (Pollutant Standards Index) across multiple time horizons using:
    - Fire detection data from NASA FIRMS
    - Meteorological forecasts from Open-Meteo
    - Historical PSI readings from Singapore NEA

    **Features:**
    - Multi-horizon predictions (24h, 48h, 72h, 7-day)
    - Real-time fire and weather monitoring
    - Model performance metrics and validation
    - WebSocket streaming for live updates

    **Model Versions:**
    - Phase 1 (Weeks 1-4): Linear regression baseline
    - Phase 2 (Weeks 5-8): XGBoost with SHAP interpretability

  version: 1.0.0
  contact:
    name: WGT
    email: aloysiuschia495@gmail.com
  license:
    name: MIT

servers:
  - url: https://api.hazeprediction.sg/v1
    description: Production server
  - url: https://staging-api.hazeprediction.sg/v1
    description: Staging server
  - url: http://localhost:8000
    description: Local development server

tags:
  - name: Predictions
    description: PSI forecasting endpoints
  - name: Current Data
    description: Real-time fire, weather, and PSI data
  - name: Historical
    description: Historical predictions and validation results
  - name: Metrics
    description: Model performance and evaluation metrics
  - name: System
    description: Health checks and system status

paths:
  /predict/{horizon}:
    get:
      tags:
        - Predictions
      summary: Get PSI prediction for specific horizon
      description: |
        Returns PSI prediction with confidence interval and contributing features.

        Update frequencies:
        - 24h predictions: Every 3 hours
        - 48h/72h predictions: Every 6 hours
        - 7d predictions: Daily

      operationId: getPrediction
      parameters:
        - name: horizon
          in: path
          required: true
          description: Prediction time horizon
          schema:
            type: string
            enum: [24h, 48h, 72h, 7d]
          example: 24h
      responses:
        '200':
          description: Successful prediction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionResponse'
              examples:
                phase1_linear:
                  summary: Phase 1 Linear Regression
                  value:
                    prediction: 87.3
                    confidence_interval: [67.3, 107.3]
                    features:
                      fire_risk_score: 62.4
                      wind_transport_score: 71.8
                      baseline_score: 54.2
                    timestamp: "2025-11-08T14:30:00+08:00"
                    target_timestamp: "2025-11-09T14:30:00+08:00"
                    horizon: "24h"
                    model_version: "phase1_linear"
                    health_advisory: "Air quality is moderate. Sensitive individuals should limit prolonged outdoor activities."

                phase2_xgboost:
                  summary: Phase 2 XGBoost with SHAP
                  value:
                    prediction: 112.5
                    confidence_interval: [92.1, 132.9]
                    features:
                      fire_count_riau: 145
                      wind_speed_current: 8.3
                      psi_current: 78
                      month: 8
                      humidity: 72.5
                    timestamp: "2025-11-08T14:30:00+08:00"
                    target_timestamp: "2025-11-09T14:30:00+08:00"
                    horizon: "24h"
                    model_version: "phase2_xgboost"
                    health_advisory: "Air quality is unhealthy. Reduce prolonged or strenuous outdoor activities."
                    shap_explanation:
                      base_value: 65.2
                      top_factors:
                        - feature: "fire_count_riau"
                          value: 145
                          contribution: 23.4
                          impact: "increases"
                        - feature: "wind_from_sw"
                          value: 1
                          contribution: 15.8
                          impact: "increases"
                        - feature: "psi_current"
                          value: 78
                          contribution: 8.1
                          impact: "increases"
        '400':
          description: Invalid horizon parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Invalid horizon. Use: 24h, 48h, 72h, or 7d"
        '500':
          description: Prediction failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Prediction failed: Unable to fetch fire data from FIRMS API"

  /predict/all:
    get:
      tags:
        - Predictions
      summary: Get predictions for all horizons
      description: Returns predictions for 24h, 48h, 72h, and 7-day horizons in a single request
      operationId: getAllPredictions
      responses:
        '200':
          description: Successful predictions for all horizons
          content:
            application/json:
              schema:
                type: object
                properties:
                  24h:
                    $ref: '#/components/schemas/PredictionResponse'
                  48h:
                    $ref: '#/components/schemas/PredictionResponse'
                  72h:
                    $ref: '#/components/schemas/PredictionResponse'
                  7d:
                    $ref: '#/components/schemas/PredictionResponse'
        '500':
          description: Prediction failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /current/psi:
    get:
      tags:
        - Current Data
      summary: Get current PSI readings
      description: |
        Returns latest PSI data from Singapore NEA API.
        Updated every 15 minutes.
        Includes readings for all 5 regions plus national value.
      operationId: getCurrentPsi
      responses:
        '200':
          description: Current PSI data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentPsiResponse'
              example:
                timestamp: "2025-11-08T14:00:00+08:00"
                update_timestamp: "2025-11-08T14:05:23+08:00"
                readings:
                  psi_24h:
                    national: 78
                    north: 72
                    south: 81
                    east: 75
                    west: 78
                    central: 76
                  pm25_24h:
                    national: 42
                    north: 38
                    south: 45
                    east: 40
                    west: 42
                    central: 41
                  pm10_24h:
                    national: 35
                    north: 32
                    south: 38
                    east: 34
                    west: 35
                    central: 33
                health_advisory: "Air quality is moderate. Sensitive individuals should limit prolonged outdoor activities."

  /current/fires:
    get:
      tags:
        - Current Data
      summary: Get active fire detections
      description: |
        Returns fire detections from NASA FIRMS for the last 24 hours.
        Data source: VIIRS NOAA-20 satellite (375m resolution).
        Updated every 15 minutes.
      operationId: getCurrentFires
      parameters:
        - name: min_confidence
          in: query
          required: false
          description: Minimum confidence level (l=low, n=normal, h=high)
          schema:
            type: string
            enum: [l, n, h]
            default: n
        - name: min_frp
          in: query
          required: false
          description: Minimum Fire Radiative Power (MW)
          schema:
            type: number
            minimum: 0
            default: 0
      responses:
        '200':
          description: Current fire detections
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FiresResponse'
              example:
                count: 247
                timestamp: "2025-11-08T14:30:00+08:00"
                fires:
                  - latitude: 0.8234
                    longitude: 101.4521
                    frp: 45.3
                    brightness: 342.1
                    confidence: "h"
                    acq_date: "2025-11-08"
                    acq_time: "1345"
                    satellite: "NOAA-20"
                    distance_to_singapore_km: 387.2
                  - latitude: 1.2341
                    longitude: 103.1234
                    frp: 128.7
                    brightness: 389.5
                    confidence: "h"
                    acq_date: "2025-11-08"
                    acq_time: "1330"
                    satellite: "NOAA-20"
                    distance_to_singapore_km: 125.4
                summary:
                  total_frp: 11234.5
                  high_confidence_count: 189
                  avg_distance_km: 412.3

  /current/weather:
    get:
      tags:
        - Current Data
      summary: Get current weather conditions
      description: |
        Returns current weather data for Singapore from Open-Meteo.
        Updated hourly.
      operationId: getCurrentWeather
      responses:
        '200':
          description: Current weather data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeatherResponse'
              example:
                timestamp: "2025-11-08T14:00:00+08:00"
                location: "Singapore"
                temperature_2m: 32.4
                relative_humidity_2m: 68.5
                wind_speed_10m: 12.3
                wind_direction_10m: 225
                wind_gusts_10m: 18.7
                pressure_msl: 1012.3
                cloud_cover: 45
                precipitation_1h: 0.0

  /historical/{horizon}:
    get:
      tags:
        - Historical
      summary: Get historical predictions and validation results
      description: |
        Returns past predictions with actual PSI values for validation.
        Useful for analyzing model performance over time.
      operationId: getHistoricalPredictions
      parameters:
        - name: horizon
          in: path
          required: true
          schema:
            type: string
            enum: [24h, 48h, 72h, 7d]
        - name: start_date
          in: query
          required: false
          description: Start date (ISO 8601 format)
          schema:
            type: string
            format: date
          example: "2025-10-01"
        - name: end_date
          in: query
          required: false
          description: End date (ISO 8601 format)
          schema:
            type: string
            format: date
          example: "2025-11-08"
        - name: limit
          in: query
          required: false
          description: Maximum number of results
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
      responses:
        '200':
          description: Historical predictions with validation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoricalPredictionsResponse'
              example:
                horizon: "24h"
                count: 245
                start_date: "2025-10-01"
                end_date: "2025-11-08"
                predictions:
                  - prediction_timestamp: "2025-11-07T14:00:00+08:00"
                    target_timestamp: "2025-11-08T14:00:00+08:00"
                    predicted_psi: 82.3
                    actual_psi: 78.0
                    absolute_error: 4.3
                    within_ci: true
                    model_version: "phase1_linear"
                  - prediction_timestamp: "2025-11-06T14:00:00+08:00"
                    target_timestamp: "2025-11-07T14:00:00+08:00"
                    predicted_psi: 91.5
                    actual_psi: 105.2
                    absolute_error: 13.7
                    within_ci: true
                    model_version: "phase1_linear"

  /metrics/{horizon}:
    get:
      tags:
        - Metrics
      summary: Get model performance metrics
      description: |
        Returns comprehensive performance metrics for specified horizon.
        Includes MAE, RMSE, alert precision/recall, and more.
      operationId: getModelMetrics
      parameters:
        - name: horizon
          in: path
          required: true
          schema:
            type: string
            enum: [24h, 48h, 72h, 7d]
        - name: period_days
          in: query
          required: false
          description: Number of days to analyze
          schema:
            type: integer
            minimum: 7
            maximum: 365
            default: 30
      responses:
        '200':
          description: Model performance metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsResponse'
              example:
                horizon: "24h"
                period_days: 30
                sample_size: 240
                last_validated: "2025-11-08T14:00:00+08:00"
                regression_metrics:
                  mae: 12.3
                  rmse: 16.8
                  r2: 0.87
                  mape: 18.5
                alert_metrics:
                  threshold: 100
                  precision: 0.89
                  recall: 0.83
                  f1_score: 0.86
                  true_positives: 42
                  false_positives: 5
                  true_negatives: 178
                  false_negatives: 9
                category_accuracy:
                  overall: 0.78
                  by_category:
                    Good: 0.92
                    Moderate: 0.81
                    Unhealthy: 0.74
                    Very Unhealthy: 0.65
                    Hazardous: 0.58
                calibration:
                  ci_coverage_95: 0.93
                  well_calibrated: true

  /metrics/compare:
    get:
      tags:
        - Metrics
      summary: Compare performance across horizons
      description: Returns performance metrics for all horizons in a single response
      operationId: compareMetrics
      parameters:
        - name: period_days
          in: query
          required: false
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Comparative metrics across all horizons
          content:
            application/json:
              schema:
                type: object
                properties:
                  period_days:
                    type: integer
                  horizons:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/MetricsResponse'

  /metrics/drift:
    get:
      tags:
        - Metrics
      summary: Get model drift analysis
      description: |
        Detects performance degradation over time.
        Compares recent performance to historical baseline.
      operationId: getModelDrift
      responses:
        '200':
          description: Model drift analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DriftResponse'
              example:
                drift_detected: false
                baseline_period: "2025-08-01 to 2025-09-30"
                current_period: "2025-10-01 to 2025-11-08"
                metrics_change:
                  24h_mae:
                    baseline: 11.8
                    current: 12.3
                    change_percent: 4.2
                    significant: false
                  24h_alert_f1:
                    baseline: 0.88
                    current: 0.86
                    change_percent: -2.3
                    significant: false
                recommendation: "No action needed. Performance stable."

  /evaluate:
    get:
      tags:
        - Metrics
      summary: Evaluate models on independent test set
      description: |
        Evaluates trained models on a configurable time period and returns performance metrics.

        **Default test period: Jan 2024 - Dec 2024** (independent from 2016-2023 training data)

        Returns comprehensive metrics including:
        - Mean Absolute Error (MAE) and RMSE for each horizon
        - Baseline (persistence) comparison
        - Model improvement percentage
        - Model coefficients (fire risk, wind transport, baseline, intercept)

        Typical execution time: 2-5 minutes for 1 year of hourly data.

      operationId: evaluateModels
      parameters:
        - name: start_date
          in: query
          required: false
          description: Start date for test set (ISO format YYYY-MM-DD)
          schema:
            type: string
            format: date
            default: "2024-01-01"
          example: "2024-01-01"
        - name: end_date
          in: query
          required: false
          description: End date for test set (ISO format YYYY-MM-DD)
          schema:
            type: string
            format: date
            default: "2024-12-31"
          example: "2024-12-31"
        - name: sample_hours
          in: query
          required: false
          description: Sampling frequency in hours (1=hourly, 6=every 6 hours, etc.)
          schema:
            type: integer
            minimum: 1
            maximum: 24
            default: 1
          example: 1
      responses:
        '200':
          description: Evaluation completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationResponse'
              example:
                test_period:
                  start_date: "2024-01-01"
                  end_date: "2024-12-31"
                  sample_hours: 1
                results:
                  24h:
                    mae: 5.23
                    rmse: 7.45
                    baseline_mae: 8.12
                    improvement_pct: 35.6
                    samples: 8760
                    coefficients:
                      fire_risk: 0.1523
                      wind_transport: 0.2045
                      baseline: 3.2156
                      intercept: 5.34
                  48h:
                    mae: 6.78
                    rmse: 9.21
                    baseline_mae: 10.45
                    improvement_pct: 35.1
                    samples: 8760
                    coefficients:
                      fire_risk: 0.1645
                      wind_transport: 0.2234
                      baseline: 3.0987
                      intercept: 6.12
                  72h:
                    mae: 7.89
                    rmse: 10.56
                    baseline_mae: 11.87
                    improvement_pct: 33.5
                    samples: 8760
                    coefficients:
                      fire_risk: 0.1734
                      wind_transport: 0.2412
                      baseline: 2.9876
                      intercept: 7.23
                  7d:
                    mae: 9.12
                    rmse: 12.34
                    baseline_mae: 14.56
                    improvement_pct: 37.4
                    samples: 8760
                    coefficients:
                      fire_risk: 0.1867
                      wind_transport: 0.2589
                      baseline: 2.7654
                      intercept: 8.45
                timestamp: "2025-11-08T14:30:00+08:00"
        '500':
          description: Evaluation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Evaluation failed: No test data available for specified period"

  /benchmark:
    post:
      tags:
        - Metrics
      summary: Run comprehensive model benchmark
      description: |
        Triggers a comprehensive evaluation of trained models on held-out test set.

        **Use this endpoint after training to validate model performance before deployment.**

        The benchmark runs asynchronously and returns a job ID for status tracking.

        Typical execution time: 5-10 minutes for 1000+ test samples.

      operationId: runBenchmark
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - test_data_path
                - models_dir
              properties:
                test_data_path:
                  type: string
                  description: Path to test set CSV file (on server)
                  example: "data/test_set.csv"
                models_dir:
                  type: string
                  description: Directory containing trained model files
                  example: "models/phase1"
                model_version:
                  type: string
                  description: Optional model version identifier
                  example: "phase1_v1.0"
      responses:
        '202':
          description: Benchmark job started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                    format: uuid
                    description: Unique job identifier for tracking
                  status:
                    type: string
                    enum: [queued, running]
                    description: Current job status
                  status_url:
                    type: string
                    description: URL to check job status
                  estimated_duration_minutes:
                    type: integer
                    description: Estimated time to completion
              example:
                job_id: "550e8400-e29b-41d4-a716-446655440000"
                status: "running"
                status_url: "/benchmark/550e8400-e29b-41d4-a716-446655440000"
                estimated_duration_minutes: 8
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Test data file not found: data/test_set.csv"
        '409':
          description: Benchmark already running
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Benchmark job already in progress (job_id: 550e8400...)"

  /benchmark/{job_id}:
    get:
      tags:
        - Metrics
      summary: Get benchmark job status and results
      description: |
        Check the status of a running benchmark job and retrieve results when complete.

        Poll this endpoint periodically (every 10-30 seconds) to track progress.

      operationId: getBenchmarkStatus
      parameters:
        - name: job_id
          in: path
          required: true
          description: Benchmark job identifier from POST /benchmark
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Benchmark job status
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/BenchmarkJobRunning'
                  - $ref: '#/components/schemas/BenchmarkJobCompleted'
                  - $ref: '#/components/schemas/BenchmarkJobFailed'
              examples:
                running:
                  summary: Job still running
                  value:
                    job_id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "running"
                    progress:
                      current_test: "TEST 3: PSI CATEGORY ACCURACY"
                      tests_completed: 2
                      tests_total: 5
                      percent_complete: 40
                    started_at: "2025-11-08T14:30:00+08:00"
                    elapsed_seconds: 180

                completed:
                  summary: Job completed successfully
                  value:
                    job_id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "completed"
                    started_at: "2025-11-08T14:30:00+08:00"
                    completed_at: "2025-11-08T14:38:23+08:00"
                    duration_seconds: 503
                    results:
                      summary:
                        tests_passed: 3
                        tests_total: 3
                        pass_rate: 1.0
                        overall_pass: true
                        test_samples: 1250
                        models_evaluated: ["24h", "48h", "72h", "7d"]
                      regression:
                        24h:
                          mae: 12.3
                          rmse: 16.8
                          r2: 0.871
                          meets_mae_target: true
                          meets_rmse_target: true
                          status: "✓ PASS"
                        48h:
                          mae: 18.7
                          rmse: 25.2
                          r2: 0.782
                          meets_mae_target: true
                          meets_rmse_target: true
                          status: "✓ PASS"
                      alerts:
                        precision: 0.894
                        recall: 0.824
                        f1_score: 0.857
                        meets_target: true
                        status: "✓ PASS"
                      categories:
                        overall_accuracy: 0.78
                        by_category:
                          Good: 0.92
                          Moderate: 0.81
                          Unhealthy: 0.74
                      seasonal:
                        "Dry Season (Jun-Oct)":
                          mae: 14.2
                          rmse: 19.8
                          alert_precision: 0.88
                        "Normal Season":
                          mae: 10.5
                          rmse: 14.3
                          alert_precision: 0.91
                      calibration:
                        24h:
                          ci_coverage: 0.93
                          well_calibrated: true
                          status: "✓ PASS"

                failed:
                  summary: Job failed with error
                  value:
                    job_id: "550e8400-e29b-41d4-a716-446655440000"
                    status: "failed"
                    started_at: "2025-11-08T14:30:00+08:00"
                    failed_at: "2025-11-08T14:32:15+08:00"
                    duration_seconds: 135
                    error: "FileNotFoundError: Test data file not found: data/test_set.csv"
                    error_details:
                      type: "FileNotFoundError"
                      traceback: "..."

        '404':
          description: Benchmark job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Benchmark job not found: 550e8400-e29b-41d4-a716-446655440000"

  /health:
    get:
      tags:
        - System
      summary: System health check
      description: |
        Returns comprehensive system status including:
        - API uptime
        - External API status (FIRMS, Open-Meteo, PSI)
        - Database connectivity
        - Last data update times
      operationId: healthCheck
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                timestamp: "2025-11-08T14:30:00+08:00"
                uptime_seconds: 2592000
                last_update:
                  fires: "2025-11-08T14:15:00+08:00"
                  weather: "2025-11-08T14:00:00+08:00"
                  psi: "2025-11-08T14:15:00+08:00"
                  predictions: "2025-11-08T14:00:00+08:00"
                api_status:
                  firms:
                    status: "operational"
                    last_check: "2025-11-08T14:30:00+08:00"
                    response_time_ms: 234
                  open_meteo:
                    status: "operational"
                    last_check: "2025-11-08T14:30:00+08:00"
                    response_time_ms: 145
                  psi:
                    status: "operational"
                    last_check: "2025-11-08T14:30:00+08:00"
                    response_time_ms: 189
                database:
                  status: "connected"
                  connection_pool_usage: "8/20"
                model:
                  version: "phase1_linear"
                  loaded: true
                  last_prediction: "2025-11-08T14:00:00+08:00"
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "unhealthy"
                timestamp: "2025-11-08T14:30:00+08:00"
                issues:
                  - "FIRMS API not responding (timeout after 30s)"
                  - "Database connection pool exhausted"

components:
  schemas:
    PredictionResponse:
      type: object
      required:
        - prediction
        - confidence_interval
        - timestamp
        - target_timestamp
        - horizon
        - model_version
      properties:
        prediction:
          type: number
          format: float
          description: Predicted PSI value
          example: 87.3
        confidence_interval:
          type: array
          description: 95% confidence interval [lower, upper]
          items:
            type: number
            format: float
          minItems: 2
          maxItems: 2
          example: [67.3, 107.3]
        features:
          type: object
          description: Input features used for prediction (varies by model version)
          additionalProperties: true
          example:
            fire_risk_score: 62.4
            wind_transport_score: 71.8
            baseline_score: 54.2
        timestamp:
          type: string
          format: date-time
          description: When the prediction was made
          example: "2025-11-08T14:30:00+08:00"
        target_timestamp:
          type: string
          format: date-time
          description: Time for which PSI is predicted
          example: "2025-11-09T14:30:00+08:00"
        horizon:
          type: string
          enum: [24h, 48h, 72h, 7d]
          description: Prediction time horizon
          example: "24h"
        model_version:
          type: string
          description: Model identifier
          enum: [phase1_linear, phase2_xgboost]
          example: "phase1_linear"
        health_advisory:
          type: string
          description: Health recommendation based on predicted PSI
          example: "Air quality is moderate. Sensitive individuals should limit prolonged outdoor activities."
        shap_explanation:
          type: object
          description: SHAP interpretability (Phase 2 only)
          properties:
            base_value:
              type: number
              description: Model baseline prediction
            top_factors:
              type: array
              description: Top 10 contributing features
              items:
                type: object
                properties:
                  feature:
                    type: string
                  value:
                    type: number
                  contribution:
                    type: number
                  impact:
                    type: string
                    enum: [increases, decreases]

    CurrentPsiResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        update_timestamp:
          type: string
          format: date-time
        readings:
          type: object
          properties:
            psi_24h:
              $ref: '#/components/schemas/RegionalReadings'
            pm25_24h:
              $ref: '#/components/schemas/RegionalReadings'
            pm10_24h:
              $ref: '#/components/schemas/RegionalReadings'
            o3_sub_index:
              $ref: '#/components/schemas/RegionalReadings'
            co_sub_index:
              $ref: '#/components/schemas/RegionalReadings'
        health_advisory:
          type: string

    RegionalReadings:
      type: object
      properties:
        national:
          type: integer
        north:
          type: integer
        south:
          type: integer
        east:
          type: integer
        west:
          type: integer
        central:
          type: integer

    FiresResponse:
      type: object
      properties:
        count:
          type: integer
          description: Number of fire detections
        timestamp:
          type: string
          format: date-time
        fires:
          type: array
          items:
            $ref: '#/components/schemas/FireDetection'
        summary:
          type: object
          properties:
            total_frp:
              type: number
              description: Sum of Fire Radiative Power (MW)
            high_confidence_count:
              type: integer
            avg_distance_km:
              type: number

    FireDetection:
      type: object
      properties:
        latitude:
          type: number
          format: float
        longitude:
          type: number
          format: float
        frp:
          type: number
          format: float
          description: Fire Radiative Power (MW)
        brightness:
          type: number
          format: float
          description: Brightness temperature (Kelvin)
        confidence:
          type: string
          enum: [l, n, h]
          description: Confidence level (low/normal/high)
        acq_date:
          type: string
          format: date
        acq_time:
          type: string
          pattern: '^\d{4}$'
          description: Acquisition time (HHMM format)
        satellite:
          type: string
        distance_to_singapore_km:
          type: number
          format: float

    WeatherResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        location:
          type: string
        temperature_2m:
          type: number
          format: float
          description: Temperature at 2m (°C)
        relative_humidity_2m:
          type: number
          format: float
          description: Relative humidity (%)
        wind_speed_10m:
          type: number
          format: float
          description: Wind speed at 10m (km/h)
        wind_direction_10m:
          type: number
          format: float
          description: Wind direction (degrees)
        wind_gusts_10m:
          type: number
          format: float
          description: Wind gusts (km/h)
        pressure_msl:
          type: number
          format: float
          description: Sea level pressure (hPa)
        cloud_cover:
          type: integer
          description: Cloud cover (%)
        precipitation_1h:
          type: number
          format: float
          description: Precipitation in last hour (mm)

    HistoricalPredictionsResponse:
      type: object
      properties:
        horizon:
          type: string
        count:
          type: integer
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        predictions:
          type: array
          items:
            type: object
            properties:
              prediction_timestamp:
                type: string
                format: date-time
              target_timestamp:
                type: string
                format: date-time
              predicted_psi:
                type: number
              actual_psi:
                type: number
                nullable: true
              absolute_error:
                type: number
                nullable: true
              within_ci:
                type: boolean
                nullable: true
              model_version:
                type: string

    MetricsResponse:
      type: object
      properties:
        horizon:
          type: string
        period_days:
          type: integer
        sample_size:
          type: integer
        last_validated:
          type: string
          format: date-time
        regression_metrics:
          type: object
          properties:
            mae:
              type: number
              description: Mean Absolute Error
            rmse:
              type: number
              description: Root Mean Squared Error
            r2:
              type: number
              description: R-squared coefficient
            mape:
              type: number
              description: Mean Absolute Percentage Error
        alert_metrics:
          type: object
          properties:
            threshold:
              type: integer
              description: PSI threshold for alerts
            precision:
              type: number
            recall:
              type: number
            f1_score:
              type: number
            true_positives:
              type: integer
            false_positives:
              type: integer
            true_negatives:
              type: integer
            false_negatives:
              type: integer
        category_accuracy:
          type: object
          properties:
            overall:
              type: number
            by_category:
              type: object
              additionalProperties:
                type: number
        calibration:
          type: object
          properties:
            ci_coverage_95:
              type: number
              description: Fraction of actuals within 95% CI
            well_calibrated:
              type: boolean

    DriftResponse:
      type: object
      properties:
        drift_detected:
          type: boolean
        baseline_period:
          type: string
        current_period:
          type: string
        metrics_change:
          type: object
          additionalProperties:
            type: object
            properties:
              baseline:
                type: number
              current:
                type: number
              change_percent:
                type: number
              significant:
                type: boolean
        recommendation:
          type: string

    EvaluationResponse:
      type: object
      required:
        - test_period
        - results
        - timestamp
      properties:
        test_period:
          type: object
          description: Time period used for evaluation
          required:
            - start_date
            - end_date
            - sample_hours
          properties:
            start_date:
              type: string
              format: date
              description: Start date of test period
              example: "2024-01-01"
            end_date:
              type: string
              format: date
              description: End date of test period
              example: "2024-12-31"
            sample_hours:
              type: integer
              description: Sampling frequency in hours
              example: 1
        results:
          type: object
          description: Evaluation metrics for each prediction horizon
          properties:
            24h:
              $ref: '#/components/schemas/HorizonEvaluation'
            48h:
              $ref: '#/components/schemas/HorizonEvaluation'
            72h:
              $ref: '#/components/schemas/HorizonEvaluation'
            7d:
              $ref: '#/components/schemas/HorizonEvaluation'
        timestamp:
          type: string
          format: date-time
          description: When the evaluation was performed

    HorizonEvaluation:
      type: object
      required:
        - mae
        - rmse
        - baseline_mae
        - improvement_pct
        - samples
        - coefficients
      properties:
        mae:
          type: number
          format: float
          description: Mean Absolute Error (PSI units)
          example: 5.23
        rmse:
          type: number
          format: float
          description: Root Mean Squared Error (PSI units)
          example: 7.45
        baseline_mae:
          type: number
          format: float
          description: Baseline (persistence) MAE for comparison
          example: 8.12
        improvement_pct:
          type: number
          format: float
          description: Percentage improvement over baseline
          example: 35.6
        samples:
          type: integer
          description: Number of test samples evaluated
          example: 8760
        coefficients:
          type: object
          description: Model coefficients for this horizon
          required:
            - fire_risk
            - wind_transport
            - baseline
            - intercept
          properties:
            fire_risk:
              type: number
              format: float
              description: Coefficient for fire risk score feature
              example: 0.1523
            wind_transport:
              type: number
              format: float
              description: Coefficient for wind transport score feature
              example: 0.2045
            baseline:
              type: number
              format: float
              description: Coefficient for baseline (current PSI) feature
              example: 3.2156
            intercept:
              type: number
              format: float
              description: Model intercept term
              example: 5.34

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        uptime_seconds:
          type: integer
        last_update:
          type: object
          properties:
            fires:
              type: string
              format: date-time
            weather:
              type: string
              format: date-time
            psi:
              type: string
              format: date-time
            predictions:
              type: string
              format: date-time
        api_status:
          type: object
          properties:
            firms:
              $ref: '#/components/schemas/ApiStatus'
            open_meteo:
              $ref: '#/components/schemas/ApiStatus'
            psi:
              $ref: '#/components/schemas/ApiStatus'
        database:
          type: object
          properties:
            status:
              type: string
              enum: [connected, disconnected, degraded]
            connection_pool_usage:
              type: string
        model:
          type: object
          properties:
            version:
              type: string
            loaded:
              type: boolean
            last_prediction:
              type: string
              format: date-time
        issues:
          type: array
          items:
            type: string
          description: List of current issues (only present if unhealthy)

    ApiStatus:
      type: object
      properties:
        status:
          type: string
          enum: [operational, degraded, down]
        last_check:
          type: string
          format: date-time
        response_time_ms:
          type: integer

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
        details:
          type: object
          description: Additional error details
          additionalProperties: true

    BenchmarkJobRunning:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [running]
        progress:
          type: object
          properties:
            current_test:
              type: string
              description: Name of currently running test
            tests_completed:
              type: integer
            tests_total:
              type: integer
            percent_complete:
              type: integer
              minimum: 0
              maximum: 100
        started_at:
          type: string
          format: date-time
        elapsed_seconds:
          type: integer

    BenchmarkJobCompleted:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [completed]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        duration_seconds:
          type: integer
        results:
          type: object
          properties:
            summary:
              type: object
              properties:
                tests_passed:
                  type: integer
                tests_total:
                  type: integer
                pass_rate:
                  type: number
                  minimum: 0
                  maximum: 1
                overall_pass:
                  type: boolean
                test_samples:
                  type: integer
                models_evaluated:
                  type: array
                  items:
                    type: string
            regression:
              type: object
              additionalProperties:
                type: object
                properties:
                  sample_size:
                    type: integer
                  mae:
                    type: number
                  rmse:
                    type: number
                  r2:
                    type: number
                  mape:
                    type: number
                  target_mae:
                    type: number
                  target_rmse:
                    type: number
                  meets_mae_target:
                    type: boolean
                  meets_rmse_target:
                    type: boolean
                  status:
                    type: string
            alerts:
              type: object
              properties:
                sample_size:
                  type: integer
                precision:
                  type: number
                recall:
                  type: number
                f1_score:
                  type: number
                true_positives:
                  type: integer
                false_positives:
                  type: integer
                true_negatives:
                  type: integer
                false_negatives:
                  type: integer
                meets_target:
                  type: boolean
                status:
                  type: string
            categories:
              type: object
              properties:
                overall_accuracy:
                  type: number
                by_category:
                  type: object
                  additionalProperties:
                    type: number
            seasonal:
              type: object
              additionalProperties:
                type: object
                properties:
                  sample_size:
                    type: integer
                  mae:
                    type: number
                  rmse:
                    type: number
                  alert_precision:
                    type: number
                    nullable: true
                  avg_psi:
                    type: number
                  max_psi:
                    type: number
            calibration:
              type: object
              additionalProperties:
                type: object
                properties:
                  ci_coverage:
                    type: number
                  expected:
                    type: number
                  well_calibrated:
                    type: boolean
                  status:
                    type: string

    BenchmarkJobFailed:
      type: object
      properties:
        job_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [failed]
        started_at:
          type: string
          format: date-time
        failed_at:
          type: string
          format: date-time
        duration_seconds:
          type: integer
        error:
          type: string
          description: Error message
        error_details:
          type: object
          properties:
            type:
              type: string
            traceback:
              type: string
