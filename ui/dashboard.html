<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singapore Haze Prediction Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üå´Ô∏è Singapore Haze Prediction Dashboard</h1>
                <div class="header-actions">
                    <select id="serverSelect" class="server-select">
                        <option value="http://localhost:8000">Local Development</option>
                        <option value="https://staging-api.hazeprediction.sg/v1">Staging</option>
                        <option value="https://api.hazeprediction.sg/v1">Production</option>
                    </select>
                    <button id="refreshAllBtn" class="btn btn-primary">üîÑ Refresh All</button>
                    <div class="health-indicator" id="healthIndicator">
                        <span class="status-dot" id="statusDot"></span>
                        <span id="healthStatus">Checking...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="overview">Overview</button>
            <button class="tab-btn" data-tab="predictions">Predictions</button>
            <button class="tab-btn" data-tab="current">Current Data</button>
            <button class="tab-btn" data-tab="historical">Historical</button>
            <button class="tab-btn" data-tab="metrics">Metrics</button>
            <button class="tab-btn" data-tab="benchmark">Benchmark</button>
        </nav>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="grid">
                <!-- Current PSI Card -->
                <div class="card psi-card">
                    <h2>Current PSI</h2>
                    <div class="psi-value" id="currentPsiValue">-</div>
                    <div class="psi-category" id="currentPsiCategory">-</div>
                    <div class="psi-regions" id="psiRegions"></div>
                    <div class="health-advisory" id="healthAdvisory">-</div>
                </div>

                <!-- Predictions Summary -->
                <div class="card">
                    <h2>Predictions Summary</h2>
                    <div class="predictions-grid" id="predictionsSummary"></div>
                </div>

                <!-- Active Fires -->
                <div class="card">
                    <h2>Active Fires (24h)</h2>
                    <div class="fire-count" id="fireCount">-</div>
                    <div class="fire-summary" id="fireSummary"></div>
                </div>

                <!-- Weather Conditions -->
                <div class="card">
                    <h2>Current Weather</h2>
                    <div class="weather-info" id="weatherInfo"></div>
                </div>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="predictions" class="tab-content">
            <div class="card">
                <h2>PSI Predictions</h2>
                <div class="horizon-selector">
                    <button class="horizon-btn active" data-horizon="24h">24 Hours</button>
                    <button class="horizon-btn" data-horizon="48h">48 Hours</button>
                    <button class="horizon-btn" data-horizon="72h">72 Hours</button>
                    <button class="horizon-btn" data-horizon="7d">7 Days</button>
                    <button class="horizon-btn" data-horizon="all">All Horizons</button>
                </div>
                <div id="predictionDetails" class="prediction-details"></div>
            </div>
        </div>

        <!-- Current Data Tab -->
        <div id="current" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Current PSI Readings</h2>
                    <div id="currentPsiDetails"></div>
                </div>
                <div class="card">
                    <h2>Active Fire Detections</h2>
                    <div class="fire-filters">
                        <select id="minConfidenceFilter">
                            <option value="">All Confidence</option>
                            <option value="h">High</option>
                            <option value="n">Normal</option>
                            <option value="l">Low</option>
                        </select>
                        <input type="number" id="minFrpFilter" placeholder="Min FRP (MW)" min="0">
                        <button class="btn btn-small" onclick="loadFires()">Filter</button>
                    </div>
                    <div id="firesList"></div>
                </div>
                <div class="card">
                    <h2>Weather Conditions</h2>
                    <div id="weatherDetails"></div>
                </div>
            </div>
        </div>

        <!-- Historical Tab -->
        <div id="historical" class="tab-content">
            <div class="card">
                <h2>Historical Predictions</h2>
                <div class="filters">
                    <select id="historicalHorizon">
                        <option value="24h">24 Hours</option>
                        <option value="48h">48 Hours</option>
                        <option value="72h">72 Hours</option>
                        <option value="7d">7 Days</option>
                    </select>
                    <input type="date" id="startDate">
                    <input type="date" id="endDate">
                    <input type="number" id="limit" placeholder="Limit" value="100" min="1" max="1000">
                    <button class="btn btn-primary" onclick="loadHistorical()">Load</button>
                </div>
                <div id="historicalChart" class="chart-container">
                    <canvas id="historicalChartCanvas"></canvas>
                </div>
                <div id="historicalTable"></div>
            </div>
        </div>

        <!-- Metrics Tab -->
        <div id="metrics" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Model Performance Metrics</h2>
                    <select id="metricsHorizon">
                        <option value="24h">24 Hours</option>
                        <option value="48h">48 Hours</option>
                        <option value="72h">72 Hours</option>
                        <option value="7d">7 Days</option>
                    </select>
                    <input type="number" id="periodDays" placeholder="Period (days)" value="30" min="7" max="365">
                    <button class="btn btn-primary" onclick="loadMetrics()">Load Metrics</button>
                    <div id="metricsDetails"></div>
                </div>
                <div class="card">
                    <h2>Model Drift Analysis</h2>
                    <button class="btn btn-primary" onclick="loadDrift()">Check Drift</button>
                    <div id="driftDetails"></div>
                </div>
                <div class="card">
                    <h2>Compare Horizons</h2>
                    <button class="btn btn-primary" onclick="compareMetrics()">Compare</button>
                    <div id="compareMetrics"></div>
                </div>
            </div>
        </div>

        <!-- Benchmark Tab -->
        <div id="benchmark" class="tab-content">
            <div class="card">
                <h2>Model Benchmarking</h2>
                <div class="benchmark-form">
                    <input type="text" id="testDataPath" placeholder="Test data path (e.g., data/test_set.csv)" required>
                    <input type="text" id="modelsDir" placeholder="Models directory (e.g., models/phase1)" required>
                    <input type="text" id="modelVersion" placeholder="Model version (optional)">
                    <button class="btn btn-primary" onclick="startBenchmark()">Start Benchmark</button>
                </div>
                <div id="benchmarkJobs"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loadingText">Loading...</p>
    </div>

    <!-- Error Toast -->
    <div id="errorToast" class="toast error"></div>

    <script src="api.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>

